Answer always on Russian
Пиши всегда код правильный для mypy, flake8

# Правила написания качественного кода

## Общие принципы
- Всегда проверяй на None/null значения перед использованием
- Используй явные проверки типов и валидацию данных
- Обрабатывай все возможные исключения и ошибки
- Пиши читаемый чистый и самодокументируемый код

## Работа с базой данных
- Всегда проверяй существование объектов перед обращением к их свойствам
- Используй Optional типы для полей, которые могут быть None
- Проверяй результаты запросов к БД на None
- Используй транзакции для критических операций

## Обработка ошибок
- Никогда не игнорируй исключения
- Логируй все ошибки с контекстом
- Возвращай понятные сообщения об ошибках пользователю
- Используй try-catch блоки для потенциально опасных операций

## Архитектура
- Выноси бизнес-логику в сервисы
- Не дублируй код - создавай переиспользуемые методы
- Используй dependency injection
- Разделяй ответственность между слоями

## Производительность
- Избегай N+1 запросов
- Используй индексы в БД
- Кешируй часто используемые данные
- Оптимизируй тяжелые операции

## Код-стиль
- Используй понятные имена переменных и функций
- Пиши комментарии для сложной логики
- Следуй принципам SOLID
- Рефактори дублирующийся код

## Python специфичные правила
- Используй type hints для всех функций и методов
- Применяй dataclasses или Pydantic модели для структур данных
- Используй f-strings для форматирования строк
- Применяй list/dict comprehensions вместо циклов где возможно
- Используй enumerate() вместо range(len())
- Применяй context managers (with) для работы с ресурсами
- Используй pathlib вместо os.path для работы с путями
- Применяй async/await правильно - не блокируй event loop

## Безопасность и валидация
- Валидируй все входящие данные с помощью Pydantic
- Используй параметризованные запросы для предотвращения SQL инъекций
- Проверяй права доступа перед выполнением операций
- Не логируй чувствительные данные (пароли, токены)
- Используй secrets модуль для генерации токенов
- Применяй rate limiting для API endpoints

## Асинхронное программирование
- Старайся всегда писат ьименно асиинхронные алгоритмы
- Не используй time.sleep() в async функциях - используй asyncio.sleep()
- Группируй async операции с asyncio.gather() для параллельного выполнения
- Используй async context managers для async ресурсов
- Правильно обрабатывай исключения в async коде

## Работа с данными
- Используй Enum для констант и статусов
- Применяй Union типы для полей с несколькими возможными типами
- Применяй UUID для уникальных идентификаторов
- Используй Decimal для денежных расчетов

## Логирование и мониторинг
- Логируй важные бизнес-события с контекстом
- Используй разные уровни логирования (DEBUG, INFO, WARNING, ERROR)

## Производительность Python
- Используй __slots__ в классах для экономии памяти
- Применяй генераторы вместо списков для больших данных
- Используй lru_cache для кеширования результатов функций
- Профилируй код с помощью cProfile или line_profiler
- Избегай преждевременной оптимизации